source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- loadDF()
df <- preprocess(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- preprocess(df)
df <- df %>% group_by(site) %>% mutate(high_cost = sum(cost)>1000)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
sum(df$high_cost)
View(df)
df1 <- df %>% filter(high_cost)
unique(df1$site)
length(unique(df1$site))
ggplot(df1) + geom_path(aes(x=month, y=scaled_imps, group=site))
df1$month <- as.numeric(df1$month)
View(df)
ggplot(df1) + geom_path(aes(x=month, y=scaled_imps, group=site))
df1 <- df1 %>% group_by(site) %>% mutate(duration=-min(month))
View(df1)
df2 <- df1 %>% filter(duration <=6)
nrow(df2)
ggplot(df2) + geom_path(aes(x=month, y=scaled_imps, group=site))
as.Date("2015-08-02") > as.Date("2015-09-01")
as.Date("2015-08-02") < as.Date("2015-09-01")
df2 <- df1 %>% filter(duration <=6, last_month < as.Date("2015-11-01"))
nrow(df2)
ggplot(df2) + geom_path(aes(x=month, y=scaled_imps, group=site))
df3 <- df1 %>% filter(duration <=6, last_month = as.Date("2016-01-01"))
df3 <- df1 %>% filter(duration <=6, last_month == as.Date("2016-01-01"))
ggplot(df3) + geom_path(aes(x=month, y=scaled_imps, group=site))
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- preprocess(df)
View(df)
ggplot(df %>% filter(duration <=10)) + geom_path(aes(x = month, y = scaled_imps, group = site, color=churn))
df$month = as.numeric(df$month)
ggplot(df %>% filter(duration <=10)) + geom_path(aes(x = month, y = scaled_imps, group = site, color=churn))
dfa <- df %>% filter(duration <=10)) %>% group_by(site, month, churn) %>% summarise(scaled_imps=mean(sacaled_imps))
dfa <- df %>% filter(duration <= 10) %>% group_by(site, month, churn) %>% summarise(scaled_imps=mean(sacaled_imps))
dfa <- df %>% filter(duration <= 10) %>% group_by(site, month, churn) %>% summarise(scaled_imps=mean(scaled_imps))
ggplot(dfa) + geom_path(aes(x = month, y = scaled_imps, group = site, color=churn))
View(df1)
View(dfa)
dfa <- df %>% filter(duration <= 10) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps))
ggplot(dfa) + geom_path(aes(x = month, y = scaled_imps, group = site, color=churn))
ggplot(dfa) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
dfa <- df %>% filter(duration <= 6) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps))
ggplot(dfa) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
View(dfa)
dfa <- df %>% filter(duration <= 6) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
ggplot(dfa) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
ggplot(dfa %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
dfa08 <- df %>% filter(duration <= 8) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
ggplot(dfa08 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
dfa10 <- df %>% filter(duration <= 10) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
ggplot(dfa10 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
dfa18 <- df %>% filter(duration <= 18) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
ggplot(dfa18 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df %>% distinct(site) %>% group_by(churn) %>% summarise(n())
df %>% filter(duration <=18) %>% distinct(site) %>% group_by(churn) %>% filter(sum(cost)>1000) %>% summarise(n())
dfa18 <- df %>% filter(duration <= 18, duration>=6) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
source('C:/Shahar/Projects/sandbox/churn/session1.R')
dfa18 <- df %>% filter(duration <= 18, duration>=6) %>% group_by(month, churn) %>% summarise(scaled_imps=mean(scaled_imps, na.rm=T))
ggplot(dfa18 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=churn))
ggplot(dfa18 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=!churn))
ggplot(dfa18 %>% filter(!is.na(churn))) + geom_path(aes(x = month, y = scaled_imps, group = churn, color=!churn),size=2)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- loadDF()
df <- preprocess()
df <- preprocess(df)
?ntile
?percentile_rank
?percent_rank
quantile(df$imps,seq(0,1,0.1))
df %>% group_by(site) %>% summarise(imps=sum(imps)) %>% `[[`("imps") %>% quantile(seq(0,1,0.1))
df %>% group_by(site) %>% filter(high_cost) %>% summarise(imps=sum(imps)) %>% `[[`("imps") %>% quantile(seq(0,1,0.1))
df %>% group_by(site) %>% filter(high_cost) %>% summarise(cost=sum(cost)) %>% `[[`("cost") %>% quantile(seq(0,1,0.1))
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- preprocess(df,50000)
df1 <- filter(df,high_cost)
analysis1(df1)
df1 -> distinct(site) %>% nrow
df1 -> distinct(site) %>% nrow()
df1 %>% distinct(site) %>% nrow()
source('C:/Shahar/Projects/sandbox/churn/session1.R')
View(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- analysis3(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- analysis3(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- loadDF()
df <- preprocess(df)
df <- analysis3(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- df %>% group_by(site) %>%
filter(duration >=6 ) %>% group_by(period) %>% summarise(imps=mean(imps), cost=mean(cost))
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- loadDF()
df <- preprocess(df, 50000)
df1 <- df %>%
filter(duration >=6 ) %>% group_by(site, period) %>% summarise(imps=mean(imps), cost=mean(cost))
View(df1)
df1 <- df %>%
filter(duration >=6 ) %>% group_by(site, period, churn) %>% summarise(imps=mean(imps), cost=mean(cost))
df1 <- df1 %>% filter(!is.na(churn))
df2 <- df1 %>% group_by(site, churn) %>% summarise(cost_1st = sum(ifelse(period = "first full 3",cost, 0)), cost_last = sum(ifelse(period = "last full 3",cost,0)), imps_1st = sum(ifelse(period = "first full 3",imps, 0))), imps_last = sum(ifelse(period = "last full 3",imps, 0)))
df2 <- df1 %>% group_by(site, churn) %>% summarise(cost_1st = sum(ifelse(period = "first full 3",cost, 0)), cost_last = sum(ifelse(period = "last full 3",cost,0)), imps_1st = sum(ifelse(period = "first full 3",imps, 0)), imps_last = sum(ifelse(period = "last full 3",imps, 0)))
df2 <- df1 %>% group_by(site, churn) %>% summarise(cost_1st = sum(ifelse(period == "first full 3",cost, 0)), cost_last = sum(ifelse(period == "last full 3",cost,0)), imps_1st = sum(ifelse(period == "first full 3",imps, 0)), imps_last = sum(ifelse(period == "last full 3",imps, 0)))
View(df2)
nrow(df2)
df1 <- df1 %>% filter(!is.na(churn), high_cost)
df1 <- df %>% filter(!is.na(churn), high_cost)
df1 <- df %>% filter(!is.na(churn), high_cost, duration >=6, duration <=18)
nrow(df1)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df1 <- analysis3(df)
df <- preprocess(df, 50000)
df1 <- analysis3(df)
debugSource('C:/Shahar/Projects/sandbox/churn/session1.R')
df <- preprocess(df, 50000)
View(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df1 <- analysis3(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
df1 <- analysis3(df)
df <- df %>% group_by(site) %>% mutate(high_cost = mean(cost)>1000)
sum(df$high_cost)
df1 <- analysis3(df)
ggplot(df1) + geom_density(aes(x=imps_ratio,color=as.factor(churn),alpha=0.3)
)
ggplot(df1) + geom_density(aes(x=imps_ratio,y=..scaled..,color=as.factor(churn),alpha=0.3)
)
ggplot(df1 %>% filter(churn==1)) + geom_density(aes(x=imps_ratio,y=..scaled..,color=as.factor(churn),alpha=0.3)
)
ggplot(df1 %>% filter(churn==1)) + geom_density(aes(x=imps_ratio,y=..scaled..,color=as.factor(churn),alpha=0.3)) + xlim(-100,100)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
df1 <- analysis3(df)
df1 %>% group_by(churn) %>% summarise(nsites=n())
nrow(df %>% filter(duration >=6, duration <=18 , !is.na(churn), high_cost) )
nrow(df %>% group_by(site, period, churn) %>% summarise(imps=mean(imps), cost=mean(cost)))
nrow(df %>% filter(duration >=6, duration <=18 , !is.na(churn), high_cost) %>% group_by(site, period, churn) %>% summarise(imps=mean(imps), cost=mean(cost)))
nrow(df %>% filter(duration >=6, duration <=18 , !is.na(churn), high_cost) %>% group_by(site, churn) %>% summarise(imps=mean(imps), cost=mean(cost)))
nrow(df %>% filter(!is.na(churn), high_cost) )
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis1(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis1(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis1(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
df3 <- analysis3(df)
View(df3)
source('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
df3 <- analysis3(df)
nrow(df3)
debugSource('C:/Shahar/Projects/sandbox/churn/session1.R')
analysis2(df)
View(df)
df %>% filter(churn) %>% distinct(sire)
df %>% filter(churn) %>% distinct(site)
df %>% filter(churn) %>% group_by(site) %>% summarise()
print(df %>% filter(churn) %>% group_by(site) %>% summarise())
df %>% filter(churn) %>% group_by(site) %>% summarise() %>% View()
df %>% filter(churn) %>% group_by(site, last_month) %>%  View()
df %>% filter(churn) %>% group_by(site, last_month) %>% summarise() %>% View()
?ehyper
??ehyper
stack()
trace()
